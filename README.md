# Kubernetes Hard Way - QEMU/libvirt Homelab

This project spins up a minimal Kubernetes cluster following the "Kubernetes The Hard Way" guide using QEMU/KVM, libvirt, and cloud-init. Everything runs locally on AMD64 Linux and uses Debian 12 VMs.

---

## ğŸ—ºï¸ Topology

| Name     | Description              | CPU | RAM   | Storage | IP             |
|----------|--------------------------|-----|-------|---------|----------------|
| jumpbox  | Administration host      | 1   | 512MB | 10GB    | 192.168.122.10 |
| server   | Kubernetes control plane | 1   | 2GB   | 20GB    | 192.168.122.11 |
| node-0   | Kubernetes worker node   | 1   | 2GB   | 20GB    | 192.168.122.21 |
| node-1   | Kubernetes worker node   | 1   | 2GB   | 20GB    | 192.168.122.22 |

---

## ğŸš€ Quickstart

### Requirements

- Linux with QEMU/KVM & libvirt installed
- `virt-install`, `genisoimage`, `wget`, `make`
- SSH key pair (`~/.ssh/id_rsa.pub` present)

### 1. Download Debian Image

```bash
make create
```

This will:
- Download Debian 12 cloud image
- Generate 4 VM disks
- Inject static IPs and cloud-init user-data
- Start the VMs using `virt-install`

### 2. Access the VMs

```bash
ssh jumpbox
ssh server
ssh node-0
ssh node-1
```

> SSH config is automatically linked to `~/.ssh/config`

### 3. Destroy Everything

```bash
make destroy
```

---

## ğŸ“ File Structure

```
k8s-homelab/
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ cloud-init/
â”‚   â””â”€â”€ user-data.template
â”œâ”€â”€ create-vm-libvirt.sh
â”œâ”€â”€ images/
â”‚   â””â”€â”€ debian-12.qcow2  # (downloaded)
â”œâ”€â”€ seed/
â”‚   â””â”€â”€ ...              # autogenerated per-VM ISO
â”œâ”€â”€ ssh/
â”‚   â””â”€â”€ config
â”œâ”€â”€ vms/
â”‚   â””â”€â”€ *.qcow2          # VM disk images
```

---

## ğŸ“¦ What cloud-init sets up

- Static networking on `ens3`
- Hostname configuration
- `/etc/hosts` populated
- SSH key injection
- `containerd`, `kubeadm`, `kubelet`, `kubectl` installation
- If server:
  - `kubeadm init`
  - kubeconfig setup for `debian` user
- If jumpbox:
  - Only `kubectl` installed

---

## â“ About genisoimage

`genisoimage` creates an ISO with cloud-init data (`user-data` and `meta-data`) that is attached as a CD-ROM to the VM. This is how the VM gets its initial config on first boot (hostname, IP, packages, etc). Without this, cloud-init would have nothing to read.

---

## ğŸ§ª Extras

- Easily extendable to more nodes or other distros
- Could be modified to use bridged networking
- Perfect for practicing the Kubernetes The Hard Way guide

---

## ğŸ™Œ Enjoy hacking Kubernetes the hard (but awesome) way!

If you have improvements or ideas, feel free to fork or adapt it to your own homelab needs.

---
